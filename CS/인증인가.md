# 인증/인가

**인증**은 **사용자 확인**을 의미하고, **인가**는 **사용자에게 권한을 부여**하는 것을 말한다

### 세션 기반 인증
###### 특징
- 서버가 상태(세션)를 관리해야 함 (Stateful)
- 쿠키를 이용해 세션을 유지 (`Set-Cookie`, `Cookie` 헤더 활용) -> 서버가 사용자 상태(Session)를 관리하기에 쿠키 이용
- 로그아웃 시 서버에서 세션 삭제 필요
- **서버 부담이 커질 수 있음** (많은 사용자가 로그인하면 세션을 관리하는 부담 증가)

###### 프로세스
1. 로그인하면 서버가 사용자의 정보를 확인하고 로그인 성공 시 세션 생성
2. 세션 ID(Session ID)를 브라우저의 쿠키에 저장 (`Set-Cookie`)
3. 사용자가 요청을 보낼 때마다 쿠키를 함께 전송 (`Cookie: session_id=abcd1234`)
4. 서버가 해당 세션 ID를 확인하여 사용자를 인증
5. 로그아웃하면 서버에서 세션 삭제, 로그인 상태 만료

### 토큰 기반 인증
###### 특징
- 서버가 상태(세션)를 관리하지 않아도 됨 (Stateless)
- 클라이언트가 인증 정보를 직접 관리 → **JWT(JSON Web Token) 같은 토큰을 브라우저 저장소에서 관리**
- 서버가 별도로 세션을 저장하지 않고도, **토큰만 검증하면 사용자 인증 가능**하기에 RESTful API에 적합 (모바일 앱, SPA, 마이크로서비스 등)
- 토큰이 클라이언트에 있기 때문에 보안적으로 조심해야 함 (토큰 탈취 방지 필요)
	- 긴 유효 기간은 보안에 위협 (토큰 탈취시 피해가 커짐)
	- 짧은 유효 기간은 사용자 경험 저해 (잦은 로그아웃)
	- ==Refresh Token을 도입하면, Access Token을 짧게 유지하면서도 사용자가 자주 로그인할 필요가 없음==

###### 프로세스
1. 로그인하면 서버가 사용자의 정보를 확인하고 로그인 성공 시 토큰 발급 (JWT 등)
2. 클라이언트는 토큰을 로컬 스토리지 또는 세션 스토리지에 저장
3. 사용자가 요청을 보낼 때마다 `Authorization: Bearer 토큰` 형태로 토큰을 포함하여 전송
4. 서버는 토큰의 유효성을 검증하여 사용자 인증
5. 로그아웃 시, 클라이언트 측에서 토큰 삭제 (서버는 신경 쓰지 않음)

#### 리프레시 토큰(Refresh Token)
###### 특징
- 리프레시 토큰은 액세스 토큰(Access Token)이 만료되었을 때, 새로운 액세스 토큰을 발급받기 위한 토큰이다
- 리프레시 토큰은 장기적인 인증 유지 용도로 사용되므로, 보안 강화를 위해 HttpOnly 쿠키에 저장하는 것이 일반적
- Access Token은 짧은 유효 기간을 두어 탈취시에 피해를 최소화하고 자주 갱신하여 보안을 강화한다
- Refresh Token은 긴 유효 기간을 가져 사용자가 로그인 상태를 계속 유지할 수 있도록 한다. (Access Token이 만료되어도 다시 로그인할 필요 없이 갱신 가능)

|**토큰 종류**|**유효 기간** (예시)|**사용 목적**|
|---|---|---|
|**Access Token**|**5~30분**|API 요청 시 사용|
|**Refresh Token**|**7일~30일 이상**|새로운 Access Token 발급|

###### 프로세스
1. 사용자가 로그인하면 **액세스 토큰 + 리프레시 토큰 발급**
2. 클라이언트는 액세스 토큰을 메모리에 저장하고 API 요청 시 사용, Refresh Token → HttpOnly 쿠키에 저장 (`Set-Cookie: refresh_token=abcd1234; HttpOnly; Secure`)
3. 클라이언트가 API 요청 시, **헤더에 Access Token 포함** (`Authorization: Bearer 액세스 토큰`)
4. 서버는 Access Token을 검증하여 요청 처리, Access Token이 유효하면 정상 응답
5. 액세스 토큰 만료 시, 클라이언트가 **Refresh Token을 포함하여 서버에 새 Access Token 요청**
6. 서버가 **리프레시 토큰을 검증 후 새 액세스 토큰 발급**
7. 클라이언트는 새 액세스 토큰을 받아 계속 API 사용
8. 사용자가 로그아웃하면, 클라이언트는 메모리 상의 **Access Token을 삭제**
9. 클라이언트가 **서버에 Refresh Token을 삭제 요청 (`DELETE /auth/logout`)**
10. 서버는 **Refresh Token을 DB에서 제거 + 쿠키 삭제 응답 (`Set-Cookie: refresh_token=; Max-Age=0`)**


