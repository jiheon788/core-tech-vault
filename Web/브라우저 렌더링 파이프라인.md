# 브라우저 렌더링 파이프라인
> Critical Rendering Path: 브라우저가 화면을 그리는 과정

![[Pasted image 20250131202302.png]]
### 1. DOM 생성
브라우저가 [[HTMLxCSS#HTML|HTML]]을 받으면, 파일을 바이트 단위로 읽는다. 브라우저의 HTML 파서는 `바이트 -> 문자 -> HTML토큰` 순서로 변환한다. HTML토큰[^1]이 생성되면, 브라우저는 이를 기반으로 DOM 트리[^2]를 생성한다

### 2. CSSOM 생성

브라우저는 [[HTMLxCSS#CSS|CSS]] 파일을 파싱한다. CSS 파일 역시 바이트로 전송되므로 브라우저는 이를 `바이트 -> 문자` 로 변환한 뒤, CSS 규칙으로 나눈다. 각 CSS 규칙은 선택자[^3]와 선언[^4]으로 구성된다.

브라우저는 이 CSS 규칙을 기반으로 CSSOM 트리[^5]를 생성한다. 

### 3. 렌더트리 생성

DOM과 CSSOM을 결합하여 렌더트리를 생성한다. 렌더 트리는 화면에 **실제 표시될 요소들로만 구성**된다. 예를 들어 display: none 속성이 있는 요소는 렌더 트리에 포함되지 않는다.

렌더 트리의 각 노드는 DOM 트리의 요소와 연결되며, CSSOM 트리에서 해당 요소에 적용된 스타일 정보를 포함한다. 즉, ===렌더 트리는 HTML 문서의 구조와 각 요소의 스타일 정보를 모두 포함한 트리===이다.

### 4. 레이아웃

브라우저는 렌더 트리를 사용해 각 요소의 정확한 위치와 크기를 계산한다. (렌더 트리의 각 노드가 화면의 어디에 위치할지, 그리고 얼마나 큰지)
이 계산은 화면의 뷰포트(viewport) 크기와 같은 정보에 의존한다.  예를 들어, 화면 크기가 변경되면 브라우저는 레이아웃 과정을 다시 수행한다. 

### 5. 페인팅

레이아웃이 완료되면, 브라우저는 각 요소를 실제로 화면에 그리는 작업을 시작한다. 페인팅 단계에서는 텍스트, 색상, 그림자, 이미지 등 모든 시각적 요소가 화면에 그려진다. 
페인팅은 화면에 표시될 그래픽 요소를 생성하는 과정이기 때문에, 복잡한 그래픽이나 애니메이션이 포함된 경우 페인트 작업이 많아져 성능이 저하될 수 있다. (Repaint)

### 6. 컴포지팅

브라우저는 화면에 그려질 요소들을 각각의 레이어(layer)로 분리하고, 이 레이어들을 결합하여 최종 화면을 구성한다. 이 과정에서는 GPU를 활용하여 각 레이어를 빠르게 합성한다. 

### 업데이트는 어떻게 이루어질까?
![[Pasted image 20250131202422.png]]
- JS가 DOM을 수정하여 업데이트 발생
- DOM이 수정 되면 Critical Rendering Path 가 다시 실행된다

![[Pasted image 20250131202827.png]]
- 이중 [[Reflow와 Repaint]]는 비싼 연산이다




>[!tip] DOM 업데이트 시 최적화 방법
>동시에 발생한 업데이트를 모아서 한번에 수정하여 Reflow와 Repaint를 최소화한다
>AS-IS
>![[Pasted image 20250131203016.png]]
TO-BE
![[Pasted image 20250131203032.png]]
리액트는 별도의 렌더링 프로세스로 이를 자동으로 해준다.
![[Pasted image 20250131203241.png]]

---

[^1]: 각각의 태그와 그 안에 포함된 텍스트, 속성들을 의미하게 된다.
[^2]: HTML 문서의 구조를 트리 형태로 표현한 것으로, 각 태그가 노드(node)가 되어 부모-자식 관계를 형성한다
[^3]: 선택자(selector): 스타일을 적용할 HTML 요소 정의
[^4]: 선언(declaration): 적용할 스타일 정의
[^5]: CSSOM 트리: DOM과 유사하게 트리구조를 가지며, 각 노드는 해당 노드에 적용될 스타일 정보를 포함한다.
